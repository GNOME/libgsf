2002-07-06  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-outfile-msole.c : initial implementation.
	* gsf/gsf-outfile.c : initial implementation.
	* gsf/gsf-output.c : initial implementation.

2002-07-05  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msole.c (ole_dirent_new) : be more anal in case the
	  input file has a cycle.

2002-07-03  Jody Goldberg <jody@gnome.org>

	* tests/test-textline.c (test) : make the compiler shut up.

2002-06-27  Morten Welinder  <terra@diku.dk>

	* gsf/gsf-input-gzip.c (check_header): Set header_size here.
	(gsf_input_gzip_read): When allocating a buffer, allocate at least
	256 bytes so we don't have to realloc all the time.
	(gsf_input_gzip_read): Handle truncated streams.

	* gsf/gsf-input.c (gsf_input_seek): Handle seeks that go to same
	position here.
	(gsf_input_uncompress): Reorganise a bit.

	* gsf/gsf-infile-msole.c (ole_dirent_free): Actually free the
	dirent.  And the list of children.

2002-06-27  Morten Welinder  <terra@diku.dk>

	* gsf/gsf-input-gzip.c (gsf_input_gzip_read): Exit on error.

	* gsf/gsf-infile-msole.c (ole_init_info): Always set error info.

	* configure.in (LIBGSF_LIBS): Include the Bonobo libs.

	* tests/test-msole2.c (test): Plug leak.  Uncompress source.

	* gsf/gsf-input.c (gsf_input_uncompress): New function.

	* gsf/gsf-input-gzip.c (gsf_input_gzip_finalize): Plug leak.

2002-06-27  Jon K Hellan  <hellan@acm.org>

	* gsf/gsf-input-bonobo.c: Actually check in the stuff mentioned
	yesterday.

2002-06-27  Morten Welinder  <terra@diku.dk>

	* gsf/gsf-input-gzip.c (gsf_input_gzip_seek): Attempt
	implementation.

	* gsf/gsf-input.c (gsf_input_seek): Make pos an off_t.

2002-06-26  Jon K Hellan  <hellan@acm.org>

	* gsf/gsf-input-bonobo.c (struct _GsfInputBonobo): Replace stream
	attribute with GsfSharedBonoboStream * 'shared'. Add 'pos'
	attribute.
	(gib_synch_shared_ptr): New helper function. Seek the shared
	stream if necessary.
	(gsf_input_bonobo_new): Probably better to free the exceptions
	*after* retrieving the exception texts.  Initialize 'shared'.
	(gsf_input_bonobo_finalize): unref 'shared'.
	(gsf_input_bonobo_dup): Implement.
	(gsf_input_bonobo_read): Use shared stream. Use
	gib_synch_shared_ptr to seek first if necessary.
	(gsf_input_bonobo_seek): Ditto.
	(gsf_input_bonobo_init): Initialize 'shared'.

	* gsf/gsf-shared-bonobo-stream.[ch]: new helper class for bonobo
	stream IO. Lets us dup the streams.
	* gsf/Makefile.am: added new files.

2002-06-26  Morten Welinder  <terra@diku.dk>

	* configure.in: If needed, define __EXTENSIONS__.

2002-06-26  Jon K Hellan  <hellan@acm.org>

	* gsf/gsf-input-bonobo.c: Include bonobo-persist-stream.h
	(gsf_input_bonobo_read): Silence warning.

2002-06-25  Jon K Hellan  <hellan@acm.org>

	* configure.in: New flag --with-bonobo

	* gsf/Makefile.am (INCLUDES): added new files.

	* gsf/gsf-input-bonobo.[ch]: new class for bonobo stream IO.

2002-06-25  Rodrigo Moya <rodrigo@gnome-db.org>

	* gsf/gsf-io-context.[ch]: new class for managing IO contexts.

	* gsf/Makefile.am: added new files.

2002-06-24  Jody Goldberg <jody@gnome.org>

	* python/Makefile.am : pyexec is not available in automake-1.4.
	nor is nodist_.
	
	* acinclude.m4 : something was still interpretting the AC_REQUIRE even
	  though ti was commented out.  change case and comment for now to
	  avoid problems.

2002-06-23  Jon K Hellan  <hellan@acm.org>

	* acinclude.m4: Comment out everything.

2002-06-21  Jody Goldberg <jody@gnome.org>

	* configure.in : uncomment the AM_CONDITIONAL for WITH_PYTHON

2002-06-21  Jon K Hellan  <hellan@acm.org>

	* acinclude.m4: Ad it. It provides AM_CHECK_PYTHON_HEADERS.

2002-06-20  Morten Welinder  <terra@diku.dk>

	* gsf/gsf-outfile-msole.c (gsf_outfile_msole_new_child): Add
	missing arg.

2002-06-20  Jon K Hellan  <hellan@acm.org>

	* configure.in: Add support for building Python bindings, but
	comment it out because it requires automake1.5.

	* Makefile.am: Build python subdir if WITH_PYTHON is set.

2002-06-18  Rui M. Seabra <rms@1407.org>

	* libgsf-1.spec.in : set permission correctly
	    fix common mistake of Copyright flag into License flag.

2002-06-18  Jody Goldberg <jody@gnome.org>

	* configure.in : lower the libxml version req

2002-06-17  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-outfile.c (gsf_outfile_new_child) : adjust signature to
	  include 'is_dir'

2002-06-15  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-input.c (gsf_input_eof) : fix docs.

	* gsf/gsf-utils.c (gsf_mem_dump) : use size_t.

2002-06-13  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-input-textline.c (gsf_input_textline_ascii_gets) : implement.
	(gsf_input_textline_utf8_gets) : pretend to implement.

2002-06-13  Jody Goldberg <jody@gnome.org>

	* Makefile.am : move the tests into a standalone dir because they are
	  getting irritating to build for every single library rebuild.

2002-06-13  Morten Welinder  <terra@diku.dk>

	* gsf/gsf-infile-msvba.c (vba_inflate): Make offset an off_t.

2002-06-13  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-outfile-msole.c : initial stub implementation.
	* gsf/gsf-outfile.c : initial stub implementation.
	* gsf/gsf-output-stdio.c : initial stub implementation.
	* gsf/gsf-output.c : initial stub implementation.

2002-06-13  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msvba.c (vba_inflate) : cleanup.

2002-06-13  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msole.h (GSF_OLE_GET_GUINT{8,16,32}) : move to
	  gsf-utils and rename.

	* gsf/gsf-input-memory.c (gsf_input_memory_dup) : silence warning.
	(gsf_input_mmap_new) : fix the no mmap case.

2002-06-12  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msvba.c (vba_inflate) : store the uncompressed
	  result.
	(vba_dirent_read) : new.  We can now lookup the correct offsets for
	  the compressed source.  The question remaining is how to fin the
	  start of the dir table ...

2002-06-12  Rodrigo Moya <rodrigo@gnome-db.org>

	* gsf/*: s/IS_GSF/GSF_IS.

2002-06-12  Jon K Hellan  <hellan@acm.org>

	* libgsf-1.pc.in (Requires): Add libxml-2.0

2002-06-11  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msole.c (gsf_infile_msole_read) : fix reading into an
	  assigned buffer for small block files.

2002-06-10  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile.c (gsf_infile_child_by_name) : typo.

2002-06-09  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* gsf/test-msole1.c (read_types): Casts to suppress signedness
	  warnings.
	* gsf/gsf-input-memory.c (gsf_input_memory_read): Changed src type to
	  guchar.
	* gsf/gsf-input-textline.c (gsf_input_textline_ascii_gets): Cast
	  return value.
	* gsf/gsf-infile-msole.c (ole_dirent_new): Signedness fixes.
	* debian/*: updated; include pkgconfig file.

2002-06-09  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msvba.c : new.
	* gsf/test-msvba.c : new.

	* gsf/gsf-infile.c (gsf_infile_child_by_vname) : new utility routine.

2002-06-07  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-input.c (gsf_input_dup) : Add an err parameter.

2002-06-07  Morten Welinder  <terra@diku.dk>

	* gsf/gsf-input-stdio.c (gsf_input_stdio_new): Plug FILE* leak.
	(gsf_input_stdio_dup): Go via filename.

2002-06-07  Jody Goldberg <jody@gnome.org>

	* doc/Makefile.am : fix the type init function for gtk-doc.
	* gsf/* : fix docs a bit.

2002-06-07  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-utils.c (gsf_input_dump) : new utility split out of.
	* gsf/test-gzip1.c (test) : here.

	* gsf/test-msole2.c (test) : spruce this up a might so that it can be
	  used as a general utility to dump streams and storages.

	* gsf/gsf-input-stdio.c (gsf_input_stdio_dup) : dup the descriptor
	  before creating a new file handle.

2002-06-06  Jody Goldberg <jody@gnome.org>

	* configure.in : remove -Wmissing-noreturn

	* gsf/test-msole1.c (test) : remove the --use-memory bit.  Just use
	  mmap.  We can test the other input types in another program.

	* gsf/*.c : change the convention for wrappers.  They all add their
	       own references to the source rather than absorbing the ref that
	       was passed in.

2002-06-06  Jody Goldberg <jody@gnome.org>

	* configure.in : add zlib.
	* libgsf-1.pc.in (Cflags) : ditto.

	* gsf/gsf-input-gzip.c : wrapper to uncompress things.

	* gsf/gsf-libxml.c : some convenience routines for dealing with libxml.

	* gsf/test-gzip1.c :  add some tests for gzip.

2002-06-05  Morten Welinder  <terra@diku.dk>

	* gsf/*.[ch]: switch to using system types.

2002-06-05  Jon K Hellan  <hellan@acm.org>

	* gsf/Makefile.am: Fix typo - libgsf_1_includedir didn't get defined.

2002-06-05  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-input-memory.c (gsf_input_mmap_new) : set the filename.

2002-06-04  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-input.c (gsf_input_eof) : do this internally.
	* gsf/gsf-input* : remove the _eof methods.

2002-06-04  Morten Welinder  <terra@diku.dk>

	* gsf/gsf-input-impl.h (GsfInputClass): Change structure members
	from "read" to "Read", etc.  This avoids names reserved by the
	system libraries.

2002-06-04  Morten Welinder  <terra@diku.dk>

	* gsf/test-msole1.c (test): Add --memory option.

	* gsf/gsf-shared-memory.c: New class.

	* gsf/gsf-input-memory.c (gsf_input_memory_new): Use new
	GsfSharedMemory class.
	(gsf_input_memory_read): Add missing parameter.

2002-06-01  Jody Goldberg <jody@gnome.org>

	* gsf/Makefile.am : Add gsf-input-textline.[ch]
	  Add gsf-libxml.[ch]

2002-05-30  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-input-stdio.h : fix the name mismatch.

2002-05-28  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-input.c (gsf_input_seek) : doh!

2002-05-28  Morten Welinder  <terra@diku.dk>

	* gsf/gsf-infile-msole.c (ole_make_bat): Cast via gconstpointer to
	please gcc.

	* gsf/gsf-infile-msole.h (GSF_OLE_GET_GUINT8, GSF_OLE_GET_GUINT16,
	GSF_OLE_GET_GUINT32): fix alignment problems.

	* gsf/test-msole1.c (read_types): Fix isspace usage.

2002-05-27  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msole.c : add some prepoc constants to prep for
	  export support.

2002-05-25  Jody Goldberg <jody@gnome.org>

	* README : add more details

2002-05-25  Jody Goldberg <jody@gnome.org>

	* gsf/test-msole1.c (get_biff_opcode_name) : suppress warning.

	* gsf/gsf-input-memory.c (gsf_input_mmap_new) : ensure it is a regular
	  file.

	* configure.in : remove -Wundef to shut it up about glib.
	  remove -Wcast-qual because we sometimes need to explicitly cast away
	  const.  C does not have const_cast<>().

2002-05-25  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-impl-utils.h (GSF_CLASS_FULL) : suppress warning.

	* gsf/gsf-infile-msole.c (ole_dirent_new) : disable debug spew.
	(ole_init_info) : suppress bogus compile warning.
	  Use gsf_ole_get_guint32s to convert the data to normal endianness.
	(gsf_ole_get_guint32s) : new.
	(ole_info_read_metabat) : assume the metabat is already uses native
	  byte ordering.

	* gsf/gsf-input.c (gsf_input_seek) : suppress warning.
	(gsf_input_dup) : ditto.
	(gsf_input_init) : ditto.

2002-05-25  J.H.M. Dassen (Ray) <jdassen@debian.org>

	* configure.in:
	  Actually use warning flags from GNOME_COMPILE_WARNINGS, so
	  "--enable-warnings=maximum" and "--with-iso-c" are honoured.
	  Test whether defining _BSD_SOURCE is needed for caddr_t.
	  (e.g. on Debian with -ansi for gcc3.0 and 3.1)
	  Test whether defining _POSIX_SOURCE is needed for fdopen().
	  Enable a lot more warnings.
	* debian/rules: minor tweaks.

2002-05-25  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-input.c (gsf_input_seek) : more error checking.

2002-05-25  Jody Goldberg <jody@gnome.org>

	* gsf/test-msole1.c (test) : dump head of odd records.

	* gsf/gsf-input.c (gsf_input_seek) : do more of the work up here.
	* gsf/gsf-infile-msole.c (gsf_infile_msole_seek) : adjust here.
	* gsf/gsf-input-stdio.c (gsf_input_stdio_seek) : and here.
	* gsf/gsf-input-memory.c (gsf_input_memory_seek) : and here.

2002-05-25  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msole.c (ole_dirent_new) : fix off by 1 error in
	  handling broken ascii stream names.

2002-05-25  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msole.c (ole_init_info) : libole2 knew about a smidge
	  more of the ole header, use the sbat counter.

	* gsf/test-msole1.c (test) : even more sanity checking.

2002-05-25  Jody Goldberg <jody@gnome.org>

	* gsf/test-msole1.c (test) : add more safety checks to automate
	  validation of imported biff records.

	* gsf/gsf-infile-msole.c (ole_dirent_new) : Based on char-width2.xls
	  it looks like directory sizes are periodically screwed.

2002-05-25  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msole.c : fix small block support.
	  Handle the bogus use of ascii stream names in some case.

2002-05-24  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-input-stdio.c (gsf_input_stdio_new) : merge the size
	  checking in here and do more error reporting.
	(gsf_input_stdio_class_init) : delete gsf_input_stdio_size
	(gsf_input_stdio_size) : delete.

	* gsf/gsf-input.c (gsf_input_read) : put the bound check here.

2002-05-24  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-input-stdio.c (gsf_input_stdio_new) : make buf_size unsigned.
	(gsf_input_stdio_finalize) : and here.
	(gsf_input_stdio_read) : and here.

	* gsf/gsf-input.c (gsf_input_seek) : As morten suggested this is
	  better as > size rather than >= size.

2002-05-24  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msole.c (gsf_infile_msole_read) : only seek if we
	  need to.

2002-05-24  Jody Goldberg <jody@gnome.org>

	* gsf/test-msole1.c (test) : more debug info, and less content spew.

2002-05-23  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-input-stdio.c (gsf_input_stdio_size) : be more careful about
	  people who open devices.

2002-05-23  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msole.c (ole_dirent_new) : more error handling.
	(ole_info_get_sb_file) : make things more readable and split this out.
	(gsf_infile_msole_new_child) : fix reading small blocks.

2002-05-23  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msole.h (GSF_OLE_GET_GUINT8) : move here.
	(GSF_OLE_GET_GUINT16) : ditto.
	(GSF_OLE_GET_GUINT32) : ditto.

2002-05-23  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-utils.h : Use the glib type macros instead of defining our
	  own.

2002-05-23  J.H.M. Dassen (Ray) <jdassen@debian.org>
 
 	* doc/Makefile.am: Introduced DOC_DIR so the location can be easily
 	overridden when building packages.
 	* debian/*: Preliminary Debian packaging.
 
2002-05-23  Jody Goldberg <jody@gnome.org>

	* gsf/gsf-infile-msole.c (ole_info_read_xbat) : DOH!
	  We need to check endianness when reading the bat elements.
	(gsf_infile_msole_read) : slow but effective work around for
	  breaking at block boundaries.  I'll work up something faster this
	  evening.

2002-05-19  Jody Goldberg <jody@gnome.org>

	* Start making this into a real package.
